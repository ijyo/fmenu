#!/bin/sh

prompt='>'
silent=

while getopts p:s OPT
do
  case $OPT in
    p) prompt=$OPTARG
      ;;
    s) silent='-s'
      ;;
  esac
done
shift $((OPTIND - 1))

output=$(mktemp -u --suffix .fmenu.output)
mkfifo $output
chmod 600 $output

term=${FMENU_DEFAULT_TERM:-alacritty --class fmenu --title fmenu}
reader=$(printf 'read %s str; echo "$str"' "$silent -p '$prompt '")
$term -e sh -c "$reader | tee $output" & disown

trap "kill $! 2>/dev/null; rm -f $output" EXIT

cat $output
