#!/bin/sh

input=$(mktemp -u --suffix .fmenu.input)
output=$(mktemp -u --suffix .fmenu.output)
mkfifo $input
mkfifo $output
chmod 600 $input $output

term=${FMENU_TERM:-st}
opts="-c fmenu -t fmenu $FMENU_TERM_DEFAULT_OPTS"
$term $opts -e sh -c "cat $input | \
  fzf --reverse $FMENU_FZF_DEFAULT_OPTS $@ | \
  tee $output" & disown

trap "kill $! 2>/dev/null; rm -f $input $output" EXIT

cat > $input
cat $output
